version: "3.9"

services:
  xhs-reporter:
    build: .
    image: xhs-reporter:latest
    env_file:
      - .env           # OPENROUTER_API_KEY 等
      - ./secrets.env  # R2/Bark 密钥等
    volumes:
      - .:/app
    environment:
      # 可覆盖默认日期，例如 20251201；不写则默认当天 UTC
      # RUN_DATE: "20251201"
    restart: "no"

  xhs-reporter-cron:
    image: xhs-reporter:latest
    env_file:
      - .env
      - ./secrets.env
    command: >
      /bin/sh -c "
        printf '0 17 * * * /app/docker-entrypoint.sh\n' | crontab - && crond -f
      "
    volumes:
      - .:/app
    restart: unless-stopped
